{const i=16;C.width=192,C.height=192;const a=e=>new Array(e).fill(0),p=(e,t,s)=>e<t&&t<s,v=e=>p(-1,e,4)?e:1e6,b=C.getContext("2d"),y=[15,99,108,226,114,102],d=[];for(let e in y){d[e]=[a(16).map((t,s)=>1<<~~(s/4)-4+s%4*4&y[e]?1:0)];for(let t=1;t<5;t++)d[e][t]=a(16).map((s,r)=>d[e][t-1][4*(r%4)+3-~~(r/4)])}let o=0,c=[a(144)],T=a(1e3).map(e=>~~(Math.random()*6)),m=[],h=0,$,x=0;const l=e=>{let t=c[o];c[o+1]=t.slice(),b.clearRect(0,0,1e3,1e3);let s,r=[],g;for(let f of[,1]){f&&($=!s&&!(r[0]&&r[1])&&o<100,g=e&&$,c[0]=a(144));for(let n in t){let u=n%12,R=~~(n/12),M=p(3,u,8)&&p(3,R,8),w=d[T[o]][h][v(R-m[1])*4+v(u-m[0])],P=t[n];w&&(M||(s=!0),r[P]=1),f&&(g&&w&&(c[o+1][n]=1-t[n]),b.fillStyle=`hsl(${$?100:0},${w&&o<100?1:0}00%,${M?P?8:4:6}0%)`,b.fillRect(n%12*i,~~(n/12)*i,i,i))}}g&&(o++,l()),S.innerHTML=`${o}/100 $${c.slice(1,o+1).map(f=>f.reduce((n,u)=>n+u)%16?1:16).reduce((f,n)=>f+n,0)-x}`};C.onmousemove=e=>{m=[~~(e.offsetX/i)-2,~~(e.offsetY/i)-2],l()},C.onmousedown=e=>e.button?o&&(x++,o--,l()):l(!0),C.onwheel=e=>{h=(h+(e.deltaY>0?1:3))%4,l()},l()}
